<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bulk-Router</title>
  <link rel="icon" href="data:," />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="panel">
    <div class="panel-header">
      <h3>Bulk-Router</h3>
      <p class="panel-description">Klick in die Karte → Zufällige Startpunkte → Routen zum Ziel.</p>
    </div>
    <div class="panel-section">
      <h4>Konfiguration</h4>
      <div class="config-group">
        <div class="switch-toggle">
          <label for="config-remember-targets">
            <input type="checkbox" id="config-remember-targets" />
            <span class="switch-slider"></span>
          </label>
          <span class="switch-text">Zielpunkte merken</span>
        </div>
      </div>
      <div class="config-group" id="targets-list-group" style="display: none;">
        <label>Zielpunkte:</label>
        <div id="targets-list" class="targets-list"></div>
      </div>
      <div class="config-group">
        <label>Profil:</label>
        <div class="profile-buttons">
          <button id="profile-bike" class="profile-btn active" data-profile="bike" title="Fahrrad">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="5.5" cy="17.5" r="3.5"></circle>
              <circle cx="18.5" cy="17.5" r="3.5"></circle>
              <path d="M15 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path>
              <path d="M12 17.5V14l-3-3 4-3 2 3h3"></path>
            </svg>
          </button>
          <button id="profile-car" class="profile-btn" data-profile="car" title="Auto">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M19.78 9.44L17.94 4.44C17.8238 4.09604 17.6036 3.79671 17.3097 3.5835C17.0159 3.37029 16.663 3.25374 16.3 3.25H7.7C7.3418 3.2508 6.99248 3.36151 6.6992 3.56716C6.40592 3.77281 6.18281 4.06351 6.06 4.4L4.22 9.4C3.92473 9.54131 3.67473 9.76216 3.49808 10.0377C3.32142 10.3133 3.22512 10.6327 3.22 10.96V15.46C3.21426 15.7525 3.28279 16.0417 3.41921 16.3006C3.55562 16.5594 3.75544 16.7794 4 16.94V17V19C4 19.2652 4.10536 19.5196 4.29289 19.7071C4.48043 19.8946 4.73478 20 5 20H6C6.26522 20 6.51957 19.8946 6.70711 19.7071C6.89464 19.5196 7 19.2652 7 19V17.25H17V19C17 19.2652 17.1054 19.5196 17.2929 19.7071C17.4804 19.8946 17.7348 20 18 20H19C19.2652 20 19.5196 19.8946 19.7071 19.7071C19.8946 19.5196 20 19.2652 20 19V17C20 17 20 17 20 16.94C20.2351 16.7808 20.4275 16.5661 20.56 16.315C20.6925 16.0639 20.7612 15.784 20.76 15.5V11C20.7567 10.6748 20.6634 10.3569 20.4904 10.0815C20.3174 9.80616 20.0715 9.58411 19.78 9.44ZM19.25 15.5C19.25 15.5663 19.2237 15.6299 19.1768 15.6768C19.1299 15.7237 19.0663 15.75 19 15.75H5C4.93369 15.75 4.87011 15.7237 4.82322 15.6768C4.77634 15.6299 4.75 15.5663 4.75 15.5V11C4.75 10.9337 4.77634 10.8701 4.82322 10.8232C4.87011 10.7763 4.93369 10.75 5 10.75H19C19.0663 10.75 19.1299 10.7763 19.1768 10.8232C19.2237 10.8701 19.25 10.9337 19.25 11V15.5ZM7.47 4.91C7.48797 4.86341 7.51949 4.82327 7.56048 4.79475C7.60147 4.76624 7.65007 4.75065 7.7 4.75H16.3C16.3499 4.75065 16.3985 4.76624 16.4395 4.79475C16.4805 4.82327 16.512 4.86341 16.53 4.91L17.93 8.75H6.07L7.47 4.91Z"></path>
              <path d="M8 14.75C8.82843 14.75 9.5 14.0784 9.5 13.25C9.5 12.4216 8.82843 11.75 8 11.75C7.17157 11.75 6.5 12.4216 6.5 13.25C6.5 14.0784 7.17157 14.75 8 14.75Z"></path>
              <path d="M16 14.75C16.8284 14.75 17.5 14.0784 17.5 13.25C17.5 12.4216 16.8284 11.75 16 11.75C15.1716 11.75 14.5 12.4216 14.5 13.25C14.5 14.0784 15.1716 14.75 16 14.75Z"></path>
            </svg>
          </button>
        </div>
      </div>
      <div class="config-group config-group-inline">
        <div class="config-field-half">
          <label for="config-n">Anzahl Routen:</label>
          <input type="number" id="config-n" min="1" max="1000" value="10" />
        </div>
        <div class="config-field-half">
          <label for="config-radius">Radius (km):</label>
          <input type="number" id="config-radius" min="0.1" max="10" step="0.1" value="2" />
        </div>
      </div>
      <div class="config-group">
        <label>Längenverteilung (Beeline):</label>
        <div class="distribution-buttons">
          <button class="dist-btn active" data-dist="lognormal" title="Lognormalverteilung">
            <svg width="20" height="12" viewBox="0 0 100 60" fill="none" stroke="currentColor" stroke-width="10" stroke-linecap="round" stroke-linejoin="round">
              <path d="M 5 55 C 7 15, 13 5, 19 18 C 28 35, 43 45, 68 52 C 83 55, 95 56, 98 56"></path>
            </svg>
          </button>
          <button class="dist-btn" data-dist="uniform" title="Gleichmäßig">
            <svg width="20" height="12" viewBox="0 0 20 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
              <line x1="2" y1="6" x2="18" y2="6"></line>
            </svg>
          </button>
          <button class="dist-btn" data-dist="near" title="Mehr nah">
            <svg width="20" height="12" viewBox="0 0 20 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
              <line x1="2" y1="2" x2="18" y2="10"></line>
            </svg>
          </button>
          <button class="dist-btn" data-dist="far" title="Mehr fern">
            <svg width="20" height="12" viewBox="0 0 20 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
              <line x1="2" y1="10" x2="18" y2="2"></line>
            </svg>
          </button>
          <button class="dist-btn" data-dist="normal" title="Normal (Glockenkurve)">
            <svg width="20" height="12" viewBox="0 0 20 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
              <path d="M2 10 Q10 2 18 10"></path>
            </svg>
          </button>
        </div>
        <canvas id="distance-histogram" width="250" height="120"></canvas>
      </div>
      <div class="config-group config-group-with-border">
        <div class="switch-toggle">
          <label for="config-aggregated">
            <input type="checkbox" id="config-aggregated" />
            <span class="switch-slider"></span>
          </label>
          <span class="switch-text">Aggregierte Darstellung</span>
        </div>
      </div>
      <div class="config-group" id="aggregation-method-group" style="display: none;">
        <label for="config-aggregation-method">Aggregierungs-Methode:</label>
        <select id="config-aggregation-method">
          <option value="simple">Einfach (schnell)</option>
          <option value="lazyOverlap">Lazy Overlap Splitting (präzise)</option>
        </select>
      </div>
      <div class="config-group" id="hide-start-points-group" style="display: none;">
        <div class="switch-toggle switch-toggle-small">
          <label for="config-hide-start-points">
            <input type="checkbox" id="config-hide-start-points" />
            <span class="switch-slider"></span>
          </label>
          <span class="switch-text">Startpunkte ausblenden</span>
        </div>
      </div>
      <div id="legend" class="legend" style="display: none;">
        <div class="legend-title">Anzahl Routen</div>
        <div class="legend-gradient">
          <div class="legend-gradient-bar" id="legend-gradient-bar"></div>
        </div>
        <div class="legend-labels">
          <span>Wenig</span>
          <span>Viel</span>
        </div>
        <div class="colormap-preview-container">
          <div class="colormap-preview" data-colormap="viridis_r" title="viridis_r">
            <div class="colormap-preview-bar" id="colormap-preview-viridis_r"></div>
          </div>
          <div class="colormap-preview" data-colormap="plasma_r" title="plasma_r">
            <div class="colormap-preview-bar" id="colormap-preview-plasma_r"></div>
          </div>
          <div class="colormap-preview" data-colormap="inferno_r" title="inferno_r">
            <div class="colormap-preview-bar" id="colormap-preview-inferno_r"></div>
          </div>
          <div class="colormap-preview" data-colormap="magma_r" title="magma_r">
            <div class="colormap-preview-bar" id="colormap-preview-magma_r"></div>
          </div>
        </div>
      </div>
      <div class="config-group" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
        <button id="export-btn" class="export-button" disabled>Routen als GeoJSON exportieren</button>
      </div>
    </div>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <!-- Core -->
  <script src="src/core/utils.js"></script>
  <script src="src/core/state.js"></script>
  <script src="src/core/config.js"></script>
  <script src="src/core/events.js"></script>
  
  <!-- Domain -->
  <script src="src/domain/geo.js"></script>
  <script src="src/domain/api.js"></script>
  <script src="src/domain/distribution.js"></script>
  
  <!-- Services -->
  <script src="src/services/aggregation-service.js"></script>
  <script src="src/services/target-service.js"></script>
  <script src="src/services/route-service.js"></script>
  <script src="src/services/export-service.js"></script>
  
  <!-- Visualization -->
  <script src="src/visualization/visualization.js"></script>
  <script src="src/visualization/map-renderer.js"></script>
  <script src="src/visualization/route-renderer.js"></script>
  
  <!-- UI -->
  <script src="src/ui/targets-list.js"></script>
  <script src="src/ui/config-helpers.js"></script>
  <script src="src/ui/distribution-selector.js"></script>
  <script src="src/ui/colormap-selector.js"></script>
  
  <!-- Handlers -->
  <script src="src/handlers/route-handler.js"></script>
  
  <!-- App -->
  <script src="src/app.js"></script>
</body>
</html>

